<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orthogonalizing EM • oem</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">oem</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/oem_vignette.html">Intro</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jaredhuling/oem">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    

    
    
<div class="contents">

<div id="build-status" class="section level3">
<h3 class="hasAnchor">
<a href="#build-status" class="anchor"></a>Build Status</h3>
<table class="table">
<thead><tr class="header">
<th>OS</th>
<th>Build</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Linux x86_64 / OSX</td>
<td><a href="https://travis-ci.org/jaredhuling/oem"><img src="https://travis-ci.org/jaredhuling/oem.svg?branch=master" alt="Build Status"></a></td>
</tr>
<tr class="even">
<td>Windows x86_64</td>
<td><a href="https://ci.appveyor.com/project/jaredhuling/oem"><img src="https://ci.appveyor.com/api/projects/status/github/jaredhuling/oem?branch=master&amp;svg=true" alt="Appveyor Build Status"></a></td>
</tr>
</tbody>
</table>
</div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The oem package provides estimaton for various penalized linear models using the <a href="http://amstat.tandfonline.com/doi/abs/10.1080/00401706.2015.1054436">Orthogonalizing EM algorithm</a>. Documentation for the package can be found here: <a href="http://casualinference.org/oem">oem site</a> (still under construction).</p>
<p>Install using the <strong>devtools</strong> package (RcppEigen must be installed first as well):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"jaredhuling/oem"</span>)</code></pre></div>
<p>or by cloning and building using <code>R CMD INSTALL</code></p>
</div>
<div id="models" class="section level2">
<h2 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h2>
<div id="lasso" class="section level3">
<h3 class="hasAnchor">
<a href="#lasso" class="anchor"></a>Lasso</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(microbenchmark)
<span class="kw">library</span>(glmnet)
<span class="kw">library</span>(oem)
<span class="co"># compute the full solution path, n &gt; p</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
n &lt;-<span class="st"> </span><span class="dv">1000000</span>
p &lt;-<span class="st"> </span><span class="dv">100</span>
m &lt;-<span class="st"> </span><span class="dv">25</span>
b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">runif</span>(m), <span class="kw">rep</span>(<span class="dv">0</span>, p -<span class="st"> </span>m)))
x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n *<span class="st"> </span>p, <span class="dt">sd =</span> <span class="dv">3</span>), n, p)
y &lt;-<span class="st"> </span><span class="kw">drop</span>(x %*%<span class="st"> </span>b) +<span class="st"> </span><span class="kw">rnorm</span>(n)

lambdas =<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y, <span class="dt">intercept =</span> <span class="ot">TRUE</span>, <span class="dt">standardize =</span> <span class="ot">FALSE</span>, <span class="dt">penalty =</span> <span class="st">"elastic.net"</span>)$lambda

<span class="kw">microbenchmark</span>(
    <span class="st">"glmnet[lasso]"</span> =<span class="st"> </span>{res1 &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">thresh =</span> <span class="fl">1e-10</span>, 
                                      <span class="dt">standardize =</span> <span class="ot">FALSE</span>,
                                      <span class="dt">intercept =</span> <span class="ot">TRUE</span>,
                                      <span class="dt">lambda =</span> lambdas)}, 
    <span class="st">"oem[lasso]"</span>    =<span class="st"> </span>{res2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y,
                                   <span class="dt">penalty =</span> <span class="st">"elastic.net"</span>,
                                   <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
                                   <span class="dt">standardize =</span> <span class="ot">FALSE</span>,
                                   <span class="dt">lambda =</span> lambdas,
                                   <span class="dt">tol =</span> <span class="fl">1e-10</span>)},
    <span class="dt">times =</span> <span class="dv">5</span>
)</code></pre></div>
<pre><code>## Unit: seconds
##           expr      min       lq     mean   median       uq      max neval
##  glmnet[lasso] 7.938060 8.138273 8.358889 8.357559 8.395648 8.964907     5
##     oem[lasso] 2.128907 2.191268 2.430306 2.449499 2.454517 2.927340     5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># difference of results</span>
<span class="kw">max</span>(<span class="kw">abs</span>(<span class="kw">coef</span>(res1) -<span class="st"> </span>res2$beta[[<span class="dv">1</span>]]))</code></pre></div>
<pre><code>## [1] 1.048072e-07</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res1 &lt;-<span class="st"> </span><span class="kw">glmnet</span>(x, y, <span class="dt">thresh =</span> <span class="fl">1e-12</span>, <span class="co"># thresh must be very low for glmnet to be accurate</span>
                                      <span class="dt">standardize =</span> <span class="ot">FALSE</span>,
                                      <span class="dt">intercept =</span> <span class="ot">TRUE</span>,
                                      <span class="dt">lambda =</span> lambdas)

<span class="kw">max</span>(<span class="kw">abs</span>(<span class="kw">coef</span>(res1) -<span class="st"> </span>res2$beta[[<span class="dv">1</span>]]))</code></pre></div>
<pre><code>## [1] 3.763398e-09</code></pre>
</div>
<div id="nonconvex-penalties" class="section level3">
<h3 class="hasAnchor">
<a href="#nonconvex-penalties" class="anchor"></a>Nonconvex Penalties</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sparsenet)
<span class="kw">library</span>(ncvreg)
<span class="kw">library</span>(plus)
<span class="co"># compute the full solution path, n &gt; p</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
n &lt;-<span class="st"> </span><span class="dv">5000</span>
p &lt;-<span class="st"> </span><span class="dv">200</span>
m &lt;-<span class="st"> </span><span class="dv">25</span>
b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">runif</span>(m, -<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="kw">rep</span>(<span class="dv">0</span>, p -<span class="st"> </span>m)))
x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n *<span class="st"> </span>p, <span class="dt">sd =</span> <span class="dv">3</span>), n, p)
y &lt;-<span class="st"> </span><span class="kw">drop</span>(x %*%<span class="st"> </span>b) +<span class="st"> </span><span class="kw">rnorm</span>(n)

mcp.lam &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y, <span class="dt">penalty =</span> <span class="st">"mcp"</span>,
               <span class="dt">gamma =</span> <span class="dv">2</span>, <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
               <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
               <span class="dt">nlambda =</span> <span class="dv">200</span>, <span class="dt">tol =</span> <span class="fl">1e-10</span>)$lambda

scad.lam &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y, <span class="dt">penalty =</span> <span class="st">"scad"</span>,
               <span class="dt">gamma =</span> <span class="dv">4</span>, <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
               <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
               <span class="dt">nlambda =</span> <span class="dv">200</span>, <span class="dt">tol =</span> <span class="fl">1e-10</span>)$lambda

<span class="kw">microbenchmark</span>(
    <span class="st">"sparsenet[mcp]"</span> =<span class="st"> </span>{res1 &lt;-<span class="st"> </span><span class="kw">sparsenet</span>(x, y, <span class="dt">thresh =</span> <span class="fl">1e-10</span>, 
                                          <span class="dt">gamma =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="co">#sparsenet throws an error </span>
                                                          <span class="co">#if you only fit 1 value of gamma</span>
                                          <span class="dt">nlambda =</span> <span class="dv">200</span>)},
    <span class="st">"oem[mcp]"</span>    =<span class="st"> </span>{res2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y,  
                                 <span class="dt">penalty =</span> <span class="st">"mcp"</span>,
                                 <span class="dt">gamma =</span> <span class="dv">2</span>,
                                 <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
                                 <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
                                 <span class="dt">nlambda =</span> <span class="dv">200</span>,
                                 <span class="dt">tol =</span> <span class="fl">1e-10</span>)},
    <span class="st">"ncvreg[mcp]"</span>    =<span class="st"> </span>{res3 &lt;-<span class="st"> </span><span class="kw">ncvreg</span>(x, y,  
                                   <span class="dt">penalty =</span> <span class="st">"MCP"</span>,
                                   <span class="dt">gamma =</span> <span class="dv">2</span>,
                                   <span class="dt">lambda =</span> mcp.lam,
                                   <span class="dt">eps =</span> <span class="fl">1e-7</span>)}, 
    <span class="st">"plus[mcp]"</span>    =<span class="st"> </span>{res4 &lt;-<span class="st"> </span><span class="kw">plus</span>(x, y,  
                                   <span class="dt">method =</span> <span class="st">"mc+"</span>,
                                   <span class="dt">gamma =</span> <span class="dv">2</span>,
                                   <span class="dt">lam =</span> mcp.lam)},
    <span class="st">"oem[scad]"</span>    =<span class="st"> </span>{res5 &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y,  
                                 <span class="dt">penalty =</span> <span class="st">"scad"</span>,
                                 <span class="dt">gamma =</span> <span class="dv">4</span>,
                                 <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
                                 <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
                                 <span class="dt">nlambda =</span> <span class="dv">200</span>,
                                 <span class="dt">tol =</span> <span class="fl">1e-10</span>)},
    <span class="st">"ncvreg[scad]"</span>    =<span class="st"> </span>{res6 &lt;-<span class="st"> </span><span class="kw">ncvreg</span>(x, y,  
                                   <span class="dt">penalty =</span> <span class="st">"SCAD"</span>,
                                   <span class="dt">gamma =</span> <span class="dv">4</span>,
                                   <span class="dt">lambda =</span> scad.lam,
                                   <span class="dt">eps =</span> <span class="fl">1e-7</span>)}, 
    <span class="st">"plus[scad]"</span>    =<span class="st"> </span>{res7 &lt;-<span class="st"> </span><span class="kw">plus</span>(x, y,  
                                   <span class="dt">method =</span> <span class="st">"scad"</span>,
                                   <span class="dt">gamma =</span> <span class="dv">4</span>,
                                   <span class="dt">lam =</span> scad.lam)}, 
    <span class="dt">times =</span> <span class="dv">5</span>
)</code></pre></div>
<pre><code>## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped
## Warning message: some lam not reached by the plus path and dropped</code></pre>
<pre><code>## Unit: milliseconds
##            expr       min        lq      mean    median        uq
##  sparsenet[mcp] 1826.6230 1832.1815 1882.6305 1848.6586 1906.9917
##        oem[mcp]  155.9794  156.4010  191.4032  157.1186  202.6081
##     ncvreg[mcp] 7166.5206 7250.1052 7935.0528 7318.2200 8420.2316
##       plus[mcp] 1638.5337 1708.5294 1725.0798 1712.0745 1743.7789
##       oem[scad]  132.8986  133.3667  133.8485  133.6422  134.0330
##    ncvreg[scad] 7615.0100 7721.4982 8210.5580 8063.8088 8351.3625
##      plus[scad] 1782.9623 1841.1951 2007.2924 1940.2403 2098.3529
##        max neval
##  1998.6978     5
##   284.9086     5
##  9520.1863     5
##  1822.4823     5
##   135.3021     5
##  9301.1106     5
##  2373.7115     5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diffs &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))
<span class="kw">colnames</span>(diffs) &lt;-<span class="st"> "abs diff"</span>
<span class="kw">rownames</span>(diffs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"MCP:  oem and ncvreg"</span>, <span class="st">"SCAD: oem and ncvreg"</span>,
                     <span class="st">"MCP:  oem and plus"</span>, <span class="st">"SCAD: oem and plus"</span>)
diffs[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">max</span>(<span class="kw">abs</span>(res2$beta[[<span class="dv">1</span>]] -<span class="st"> </span>res3$beta)), <span class="kw">max</span>(<span class="kw">abs</span>(res5$beta[[<span class="dv">1</span>]] -<span class="st"> </span>res6$beta)),
               <span class="kw">max</span>(<span class="kw">abs</span>(res2$beta[[<span class="dv">1</span>]][-<span class="dv">1</span>,<span class="dv">1</span>:<span class="kw">nrow</span>(res4$beta)] -<span class="st"> </span><span class="kw">t</span>(res4$beta))),
               <span class="kw">max</span>(<span class="kw">abs</span>(res5$beta[[<span class="dv">1</span>]][-<span class="dv">1</span>,<span class="dv">1</span>:<span class="kw">nrow</span>(res7$beta)] -<span class="st"> </span><span class="kw">t</span>(res7$beta))))
diffs</code></pre></div>
<pre><code>##                          abs diff
## MCP:  oem and ncvreg 1.725859e-07
## SCAD: oem and ncvreg 5.094648e-08
## MCP:  oem and plus   2.684108e-11
## SCAD: oem and plus   1.732414e-11</code></pre>
</div>
<div id="group-lasso" class="section level3">
<h3 class="hasAnchor">
<a href="#group-lasso" class="anchor"></a>Group Lasso</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gglasso)
<span class="kw">library</span>(grpreg)
<span class="kw">library</span>(grplasso)
<span class="co"># compute the full solution path, n &gt; p</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
n &lt;-<span class="st"> </span><span class="dv">5000</span>
p &lt;-<span class="st"> </span><span class="dv">200</span>
m &lt;-<span class="st"> </span><span class="dv">25</span>
b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">runif</span>(m, -<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="kw">rep</span>(<span class="dv">0</span>, p -<span class="st"> </span>m)))
x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n *<span class="st"> </span>p, <span class="dt">sd =</span> <span class="dv">3</span>), n, p)
y &lt;-<span class="st"> </span><span class="kw">drop</span>(x %*%<span class="st"> </span>b) +<span class="st"> </span><span class="kw">rnorm</span>(n)
groups &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>:<span class="kw">floor</span>(p/<span class="dv">10</span>), <span class="dt">each =</span> <span class="dv">10</span>)

grp.lam &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y, <span class="dt">penalty =</span> <span class="st">"grp.lasso"</span>,
               <span class="dt">groups =</span> groups,
               <span class="dt">nlambda =</span> <span class="dv">100</span>, <span class="dt">tol =</span> <span class="fl">1e-10</span>)$lambda


<span class="kw">microbenchmark</span>(
    <span class="st">"gglasso[grp.lasso]"</span> =<span class="st"> </span>{res1 &lt;-<span class="st"> </span><span class="kw">gglasso</span>(x, y, <span class="dt">group =</span> groups, 
                                            <span class="dt">lambda =</span> grp.lam, 
                                            <span class="dt">intercept =</span> <span class="ot">FALSE</span>,
                                            <span class="dt">eps =</span> <span class="fl">1e-8</span>)},
    <span class="st">"oem[grp.lasso]"</span>    =<span class="st"> </span>{res2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y,  
                                       <span class="dt">groups =</span> groups,
                                       <span class="dt">intercept =</span> <span class="ot">FALSE</span>,
                                       <span class="dt">standardize =</span> <span class="ot">FALSE</span>,
                                       <span class="dt">penalty =</span> <span class="st">"grp.lasso"</span>,
                                       <span class="dt">lambda =</span> grp.lam,
                                       <span class="dt">tol =</span> <span class="fl">1e-10</span>)},
    <span class="st">"grplasso[grp.lasso]"</span>    =<span class="st"> </span>{res3 &lt;-<span class="st"> </span><span class="kw">grplasso</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, 
                                                 <span class="dt">index =</span> groups,
                                                 <span class="dt">standardize =</span> <span class="ot">FALSE</span>, 
                                                 <span class="dt">center =</span> <span class="ot">FALSE</span>, <span class="dt">model =</span> <span class="kw">LinReg</span>(), 
                                                 <span class="dt">lambda =</span> grp.lam *<span class="st"> </span>n *<span class="st"> </span><span class="dv">2</span>, 
                                                 <span class="dt">control =</span> <span class="kw">grpl.control</span>(<span class="dt">trace =</span> <span class="dv">0</span>, <span class="dt">tol =</span> <span class="fl">1e-10</span>))}, 
    <span class="st">"grpreg[grp.lasso]"</span>    =<span class="st"> </span>{res4 &lt;-<span class="st"> </span><span class="kw">grpreg</span>(x, y, <span class="dt">group =</span> groups, 
                                             <span class="dt">eps =</span> <span class="fl">1e-10</span>, <span class="dt">lambda =</span> grp.lam)},
    <span class="dt">times =</span> <span class="dv">5</span>
)</code></pre></div>
<pre><code>## Unit: milliseconds
##                 expr        min         lq       mean    median         uq
##   gglasso[grp.lasso] 1845.71946 1951.62624 2062.28094 1984.9100 1989.83776
##       oem[grp.lasso]   83.49379   84.27574   90.68919   84.3093   88.62129
##  grplasso[grp.lasso] 4330.15263 4373.55362 5009.09593 4530.1962 5226.72671
##    grpreg[grp.lasso] 1093.06789 1126.79137 1201.43302 1178.0597 1240.50702
##        max neval
##  2539.3112     5
##   112.7458     5
##  6584.8505     5
##  1368.7391     5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diffs &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="dt">dim =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))
<span class="kw">colnames</span>(diffs) &lt;-<span class="st"> "abs diff"</span>
<span class="kw">rownames</span>(diffs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"oem and gglasso"</span>, <span class="st">"oem and grplasso"</span>)
diffs[,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(  <span class="kw">max</span>(<span class="kw">abs</span>(res2$beta[[<span class="dv">1</span>]][-<span class="dv">1</span>,] -<span class="st"> </span>res1$beta)), <span class="kw">max</span>(<span class="kw">abs</span>(res2$beta[[<span class="dv">1</span>]][-<span class="dv">1</span>,] -<span class="st"> </span>res3$coefficients))  )
diffs</code></pre></div>
<pre><code>##                      abs diff
## oem and gglasso  1.729379e-06
## oem and grplasso 4.828369e-08</code></pre>
<div id="bigger-group-lasso-example" class="section level4">
<h4 class="hasAnchor">
<a href="#bigger-group-lasso-example" class="anchor"></a>Bigger Group Lasso Example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
n &lt;-<span class="st"> </span><span class="dv">500000</span>
p &lt;-<span class="st"> </span><span class="dv">200</span>
m &lt;-<span class="st"> </span><span class="dv">25</span>
b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">runif</span>(m, -<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="kw">rep</span>(<span class="dv">0</span>, p -<span class="st"> </span>m)))
x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n *<span class="st"> </span>p, <span class="dt">sd =</span> <span class="dv">3</span>), n, p)
y &lt;-<span class="st"> </span><span class="kw">drop</span>(x %*%<span class="st"> </span>b) +<span class="st"> </span><span class="kw">rnorm</span>(n)
groups &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>:<span class="kw">floor</span>(p/<span class="dv">10</span>), <span class="dt">each =</span> <span class="dv">10</span>)

<span class="kw">system.time</span>(res &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y, <span class="dt">penalty =</span> <span class="st">"grp.lasso"</span>,
                       <span class="dt">groups =</span> groups,
                       <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
                       <span class="dt">intercept =</span> <span class="ot">TRUE</span>,
                       <span class="dt">nlambda =</span> <span class="dv">100</span>, <span class="dt">tol =</span> <span class="fl">1e-10</span>))</code></pre></div>
<pre><code>##    user  system elapsed 
##    3.04    0.17    3.21</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># memory usage is out of control here.</span>
<span class="co"># oem uses approximately 1/3 of the memory</span>
<span class="kw">system.time</span>(res2 &lt;-<span class="st"> </span><span class="kw">grpreg</span>(x, y, <span class="dt">group =</span> groups, 
                           <span class="dt">eps =</span> <span class="fl">1e-10</span>, <span class="dt">lambda =</span> res$lambda))</code></pre></div>
<pre><code>##    user  system elapsed 
##   64.17    1.15   65.75</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># I think the standardization is done</span>
<span class="co"># differently for grpreg</span>
<span class="kw">max</span>(<span class="kw">abs</span>(res$beta[[<span class="dv">1</span>]] -<span class="st"> </span>res2$beta))</code></pre></div>
<pre><code>## [1] 0.0007842304</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(<span class="kw">abs</span>(res$beta[[<span class="dv">1</span>]] -<span class="st"> </span>res2$beta))</code></pre></div>
<pre><code>## [1] 8.363514e-06</code></pre>
</div>
</div>
<div id="fitting-multiple-penalties" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-multiple-penalties" class="anchor"></a>Fitting Multiple Penalties</h3>
<p>The oem algorithm is quite efficient at fitting multiple penalties simultaneously when p is not too big.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">123</span>)
n &lt;-<span class="st"> </span><span class="dv">100000</span>
p &lt;-<span class="st"> </span><span class="dv">100</span>
m &lt;-<span class="st"> </span><span class="dv">15</span>
b &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="kw">runif</span>(m, -<span class="fl">0.25</span>, <span class="fl">0.25</span>), <span class="kw">rep</span>(<span class="dv">0</span>, p -<span class="st"> </span>m)))
x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n *<span class="st"> </span>p, <span class="dt">sd =</span> <span class="dv">3</span>), n, p)
y &lt;-<span class="st"> </span><span class="kw">drop</span>(x %*%<span class="st"> </span>b) +<span class="st"> </span><span class="kw">rnorm</span>(n)

<span class="kw">microbenchmark</span>(
    <span class="st">"oem[lasso]"</span>    =<span class="st"> </span>{res1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y,
                                   <span class="dt">penalty =</span> <span class="st">"elastic.net"</span>,
                                   <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
                                   <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
                                   <span class="dt">tol =</span> <span class="fl">1e-10</span>)},
    <span class="st">"oem[lasso/mcp/scad/ols]"</span>    =<span class="st"> </span>{res2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/oem.html">oem</a></span>(x, y,
                                   <span class="dt">penalty =</span> <span class="kw">c</span>(<span class="st">"elastic.net"</span>, <span class="st">"mcp"</span>, <span class="st">"scad"</span>, <span class="st">"grp.lasso"</span>),
                                   <span class="dt">gamma =</span> <span class="dv">4</span>,
                                   <span class="dt">groups =</span> <span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">10</span>),
                                   <span class="dt">intercept =</span> <span class="ot">TRUE</span>, 
                                   <span class="dt">standardize =</span> <span class="ot">TRUE</span>,
                                   <span class="dt">tol =</span> <span class="fl">1e-10</span>)},
    <span class="dt">times =</span> <span class="dv">5</span>
)</code></pre></div>
<pre><code>## Unit: milliseconds
##                     expr      min       lq     mean   median       uq
##               oem[lasso] 220.0712 220.5291 228.8863 222.2841 226.6679
##  oem[lasso/mcp/scad/ols] 239.3659 240.8303 255.4489 241.3245 265.1960
##       max neval
##  254.8794     5
##  290.5280     5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#png("../mcp_path.png", width = 3000, height = 3000, res = 400);par(mar=c(5.1,5.1,4.1,2.1));plot(res2, which.model = 2, main = "mcp",lwd = 3,cex.axis=2.0, cex.lab=2.0, cex.main=2.0, cex.sub=2.0);dev.off()</span>
<span class="co">#</span>

<span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="dv">1</span>:<span class="dv">4</span>, <span class="dt">ncol=</span><span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))
<span class="kw">plot</span>(res2, <span class="dt">which.model =</span> <span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>,
     <span class="dt">xvar =</span> <span class="st">"lambda"</span>)
<span class="kw">plot</span>(res2, <span class="dt">which.model =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>,
     <span class="dt">xvar =</span> <span class="st">"lambda"</span>)
<span class="kw">plot</span>(res2, <span class="dt">which.model =</span> <span class="dv">3</span>, <span class="dt">lwd =</span> <span class="dv">2</span>,
     <span class="dt">xvar =</span> <span class="st">"lambda"</span>)
<span class="kw">plot</span>(res2, <span class="dt">which.model =</span> <span class="dv">4</span>, <span class="dt">lwd =</span> <span class="dv">2</span>,
     <span class="dt">xvar =</span> <span class="st">"lambda"</span>)</code></pre></div>
<p><img src="articles/mult-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cran.r-project.org/package=oem">https://​cran.r-project.org/​package=oem</a>
</li>
<li>Browse source code at <br><a href="https://github.com/jaredhuling/oem">https://​github.com/​jaredhuling/​oem</a>
</li>
<li>Report a bug at <br><a href="https://github.com/jaredhuling/oem/issues">https://​github.com/​jaredhuling/​oem/​issues</a>
</li>
</ul>
<h2>License</h2>
<p>GPL (&gt;= 2)</p>
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Bin Dai <br><small class="roles"> Author </small> </li>
<li>Jared Huling <br><small class="roles"> Author, maintainer </small> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=oem"><img src="http://www.r-pkg.org/badges/version/oem" alt="version"></a></li>
</ul>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bin Dai, Jared Huling.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
